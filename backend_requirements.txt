# ALEX FRONTEND - BACKEND REQUIREMENTS SPECIFICATION (v2.1)
# This document defines the EXACT JSON structures and behaviors the Frontend expects.
# Backend developers: Please ensure your API/MQTT responses match these schemas to prevent UI crashes.

================================================================================
1. SYSTEM HEALTH (HTTP)
================================================================================
The frontend polls this HTTP endpoint every 10 seconds to show the "System Health" widget.

[GET] http://127.0.0.1:8033/health

[RESPONSE PAYLOAD]
{
  "status": "ok",              // Enum: "ok" | "degraded" | "error"
  "uptime_sec": 3600,          // Integer: Seconds since backend start
  "mqtt_connected": true,      // Boolean: Internal backend connection to HiveMQ
  "agent_running": true,       // Boolean: Is the Live Agent loop active?
  "timestamp": "2026-01-09T..." // ISO String
}

[VISUAL IMPACT]
- "status": Controls the green/orange color bar.
- "mqtt_connected": Shows "Connected" (Green) or "Disconnected" (Red) in widget.
- "agent_running": Shows "Active" (Purple) or "Idle" (Grey).

================================================================================
2. DASHBOARD (MQTT)
================================================================================

[A] HEARTBEAT
Topic: alex/dashboard/state
Frequency: Every 5 seconds (Backend initiated)

[PAYLOAD]
{
  "is_active": true,           // Controls: Agent Status Card "Active" badge
  "battery_level": 85,         // Controls: Battery % text
  "is_connected": true,        // Controls: "Online" indicator
  "active_status_message": "Listening for wake word..." // Controls: Subtitle text
}

[B] DATA REQUEST
Topic: dashboard/request
Frontend sends: "GET" (Every 60s)
Expected Response Topic: dashboard/response

[PAYLOAD]
{
  "weather": {
    "location": "Jakarta",
    "condition": "Cloudy",
    "temp_c": 28,
    "icon": "cloud"            // IMPORTANT: Must match a Google Material Symbol name
                               // e.g., "sunny", "cloud", "rainy", "thunderstorm"
  },
  "integrations": {            // Controls: Green/Grey dots on Integrations Page
    "GOOGLE": true,
    "SPOTIFY": false,
    "WHATSAPP": true
  }
}

================================================================================
3. MEMORY & ACTIVITY (MQTT)
================================================================================

[A] ACTIVITY SEARCH
Topic: memory/activity/search
Frontend sends: { "query": "...", "limit": 20, "activity_type": null, "days_back": 30 }
Expected Response Topic: memory/activity/response

[PAYLOAD]
{
  "results": [
    {
      "id": 101,
      "activity_type": "note_taken",  // Enum: "note_taken" | "auth_event" | "system_log"
      "timestamp": "2026-01-09T10:00:00Z",
      "activity_data": {              // Flexible object displayed as JSON snippet
        "note_id": "rec_123",
        "title": "Meeting Notes"
      }
    },
    {
      "id": 102,
      "activity_type": "auth_event",
      "timestamp": "2026-01-09T09:30:00Z",
      "activity_data": {
        "service": "SPOTIFY",
        "status": "SUCCESS"
      }
    }
  ]
}

[VISUAL IMPACT]
- "activity_type": Maps to icons:
    - "note_taken" -> "edit_note" (Purple Icon)
    - "auth_event" -> "vpn_key" (Amber Icon)
    - Others -> "list" (Grey Icon)

[B] MEMORY STATS
Topic: memory/stats/request
Frontend sends: "get_stats"
Expected Response Topic: memory/stats/response

[PAYLOAD]
{
  "total": 1542,
  "last_24h": 12,
  "by_type": {
    "note_taken": 45,
    "auth_event": 5,
    "conversation": 120
  }
}

================================================================================
4. SMART NOTES (MQTT)
================================================================================

[A] RECORDING CONTROL
Frontend sends: "NOTEON" (Start) or "NOTEOFF" (Stop) to /note/1

[B] STATUS UPDATES
Topic: /note/status
Backend should send updates as state changes.

[PAYLOADS]
1. { "status": "RECORDING" }
2. { "status": "TRANSCRIBING", "progress": 20 }
3. { "status": "PROCESSING", "progress": 40, "message": "Analyzing text..." }
4. { "status": "COMPLETE" }
5. { "status": "ERROR", "message": "Microphone unreachable" }

[C] FINAL RESULT
Topic: gacor/1
Triggered when processing finishes.

[PAYLOAD]
{
  "type": "note_summary",
  "session_id": "sess_8823",
  "timestamp": "2026-01-09...",
  "duration_minutes": 15,
  "preview_text": "This user discussed the project roadmap...", // Main summary
  "artifacts": {
    "flashcards": "flashcards_sess_8823.json",  // Filename or key
    "quiz": "quiz_sess_8823.json",
    "master_guide": "guide_sess_8823.md"
  }
}

[VISUAL IMPACT]
- "artifacts": If keys exist (flashcards/quiz), buttons appear in UI to open them.

================================================================================
5. AUTHENTICATION (MQTT)
================================================================================

Topic: /user1/0 (Request) -> /user2/0 (Response)

[FLOW]
1. Frontend sends: "AUTH:SPOTIFY"
2. Backend responds: "http://accounts.spotify.com/..."
   -> Frontend opens Popup.
3. User completes login.
4. Backend responds: "SUCCESS:SPOTIFY"
   -> Frontend updates UI to "Connected" state.

[ERROR HANDLING]
Backend can send: "ERROR:Timeout", "AUTH_BUSY", "UNKNOWN:SERVICE"
